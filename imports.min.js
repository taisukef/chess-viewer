const e=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,t=Symbol(),r=new Map;class i{constructor(e,r){if(this._$cssResult$=!0,r!==t)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){let t=r.get(this.cssText);return e&&void 0===t&&(r.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const n=e?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let r="";for(const t of e.cssRules)r+=t.cssText;return(e=>new i("string"==typeof e?e:e+"",t))(r)})(e):e;var s,o;const a={toAttribute(e,t){switch(t){case Boolean:e=e?"":null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let r=e;switch(t){case Boolean:r=null!==e;break;case Number:r=null===e?null:Number(e);break;case Object:case Array:try{r=JSON.parse(e)}catch(e){r=null}}return r}},l=(e,t)=>t!==e&&(t==t||e==e),c={attribute:!0,type:String,converter:a,reflect:!1,hasChanged:l};class p extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(e){var t;null!==(t=this.l)&&void 0!==t||(this.l=[]),this.l.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,r)=>{const i=this._$Eh(r,t);void 0!==i&&(this._$Eu.set(i,r),e.push(i))})),e}static createProperty(e,t=c){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const r="symbol"==typeof e?Symbol():"__"+e,i=this.getPropertyDescriptor(e,r,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}}static getPropertyDescriptor(e,t,r){return{get(){return this[t]},set(i){const n=this[e];this[t]=i,this.requestUpdate(e,n,r)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||c}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const r of t)this.createProperty(r,e[r])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const r=new Set(e.flat(1/0).reverse());for(const e of r)t.unshift(n(e))}else void 0!==e&&t.push(n(e));return t}static _$Eh(e,t){const r=t.attribute;return!1===r?void 0:"string"==typeof r?r:"string"==typeof e?e.toLowerCase():void 0}o(){var e;this._$Ev=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Ep(),this.requestUpdate(),null===(e=this.constructor.l)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,r;(null!==(t=this._$Em)&&void 0!==t?t:this._$Em=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(r=e.hostConnected)||void 0===r||r.call(e))}removeController(e){var t;null===(t=this._$Em)||void 0===t||t.splice(this._$Em.indexOf(e)>>>0,1)}_$Ep(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Et.set(t,this[t]),delete this[t])}))}createRenderRoot(){var t;const r=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,r)=>{e?t.adoptedStyleSheets=r.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):r.forEach((e=>{const r=document.createElement("style"),i=window.litNonce;void 0!==i&&r.setAttribute("nonce",i),r.textContent=e.cssText,t.appendChild(r)}))})(r,this.constructor.elementStyles),r}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$Em)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$Em)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,r){this._$AK(e,r)}_$Eg(e,t,r=c){var i,n;const s=this.constructor._$Eh(e,r);if(void 0!==s&&!0===r.reflect){const o=(null!==(n=null===(i=r.converter)||void 0===i?void 0:i.toAttribute)&&void 0!==n?n:a.toAttribute)(t,r.type);this._$Ei=e,null==o?this.removeAttribute(s):this.setAttribute(s,o),this._$Ei=null}}_$AK(e,t){var r,i,n;const s=this.constructor,o=s._$Eu.get(e);if(void 0!==o&&this._$Ei!==o){const e=s.getPropertyOptions(o),l=e.converter,c=null!==(n=null!==(i=null===(r=l)||void 0===r?void 0:r.fromAttribute)&&void 0!==i?i:"function"==typeof l?l:null)&&void 0!==n?n:a.fromAttribute;this._$Ei=o,this[o]=c(t,e.type),this._$Ei=null}}requestUpdate(e,t,r){let i=!0;void 0!==e&&(((r=r||this.constructor.getPropertyOptions(e)).hasChanged||l)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===r.reflect&&this._$Ei!==e&&(void 0===this._$ES&&(this._$ES=new Map),this._$ES.set(e,r))):i=!1),!this.isUpdatePending&&i&&(this._$Ev=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ev}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((e,t)=>this[t]=e)),this._$Et=void 0);let t=!1;const r=this._$AL;try{t=this.shouldUpdate(r),t?(this.willUpdate(r),null===(e=this._$Em)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(r)):this._$ET()}catch(e){throw t=!1,this._$ET(),e}t&&this._$AE(r)}willUpdate(e){}_$AE(e){var t;null===(t=this._$Em)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$ET(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ev}shouldUpdate(e){return!0}update(e){void 0!==this._$ES&&(this._$ES.forEach(((e,t)=>this._$Eg(t,this[t],e))),this._$ES=void 0),this._$ET()}updated(e){}firstUpdated(e){}}var h,u;p.finalized=!0,p.elementProperties=new Map,p.elementStyles=[],p.shadowRootOptions={mode:"open"},null===(s=globalThis.reactiveElementPolyfillSupport)||void 0===s||s.call(globalThis,{ReactiveElement:p}),(null!==(o=globalThis.reactiveElementVersions)&&void 0!==o?o:globalThis.reactiveElementVersions=[]).push("1.0.0");const d=globalThis.trustedTypes,f=d?d.createPolicy("lit-html",{createHTML:e=>e}):void 0,g=`lit$${(Math.random()+"").slice(9)}$`,v="?"+g,m=`<${v}>`,_=document,y=(e="")=>_.createComment(e),b=e=>null===e||"object"!=typeof e&&"function"!=typeof e,P=Array.isArray,C=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,k=/-->/g,w=/>/g,$=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,S=/'/g,A=/"/g,E=/^(?:script|style|textarea)$/i,L=e=>(t,...r)=>({_$litType$:e,strings:t,values:r}),x=L(1),q=L(2),M=Symbol.for("lit-noChange"),T=Symbol.for("lit-nothing"),R=new WeakMap,O=(e,t,r)=>{var i,n;const s=null!==(i=null==r?void 0:r.renderBefore)&&void 0!==i?i:t;let o=s._$litPart$;if(void 0===o){const e=null!==(n=null==r?void 0:r.renderBefore)&&void 0!==n?n:null;s._$litPart$=o=new D(t.insertBefore(y(),e),e,void 0,null!=r?r:{})}return o._$AI(e),o},N=_.createTreeWalker(_,129,null,!1);class U{constructor({strings:e,_$litType$:t},r){let i;this.parts=[];let n=0,s=0;const o=e.length-1,a=this.parts,[l,c]=((e,t)=>{const r=e.length-1,i=[];let n,s=2===t?"<svg>":"",o=C;for(let t=0;t<r;t++){const r=e[t];let a,l,c=-1,p=0;for(;p<r.length&&(o.lastIndex=p,l=o.exec(r),null!==l);)p=o.lastIndex,o===C?"!--"===l[1]?o=k:void 0!==l[1]?o=w:void 0!==l[2]?(E.test(l[2])&&(n=RegExp("</"+l[2],"g")),o=$):void 0!==l[3]&&(o=$):o===$?">"===l[0]?(o=null!=n?n:C,c=-1):void 0===l[1]?c=-2:(c=o.lastIndex-l[2].length,a=l[1],o=void 0===l[3]?$:'"'===l[3]?A:S):o===A||o===S?o=$:o===k||o===w?o=C:(o=$,n=void 0);const h=o===$&&e[t+1].startsWith("/>")?" ":"";s+=o===C?r+m:c>=0?(i.push(a),r.slice(0,c)+"$lit$"+r.slice(c)+g+h):r+g+(-2===c?(i.push(void 0),t):h)}const a=s+(e[r]||"<?>")+(2===t?"</svg>":"");return[void 0!==f?f.createHTML(a):a,i]})(e,t);if(this.el=U.createElement(l,r),N.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(i=N.nextNode())&&a.length<o;){if(1===i.nodeType){if(i.hasAttributes()){const e=[];for(const t of i.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(g)){const r=c[s++];if(e.push(t),void 0!==r){const e=i.getAttribute(r.toLowerCase()+"$lit$").split(g),t=/([.?@])?(.*)/.exec(r);a.push({type:1,index:n,name:t[2],strings:e,ctor:"."===t[1]?B:"?"===t[1]?K:"@"===t[1]?H:I})}else a.push({type:6,index:n})}for(const t of e)i.removeAttribute(t)}if(E.test(i.tagName)){const e=i.textContent.split(g),t=e.length-1;if(t>0){i.textContent=d?d.emptyScript:"";for(let r=0;r<t;r++)i.append(e[r],y()),N.nextNode(),a.push({type:2,index:++n});i.append(e[t],y())}}}else if(8===i.nodeType)if(i.data===v)a.push({type:2,index:n});else{let e=-1;for(;-1!==(e=i.data.indexOf(g,e+1));)a.push({type:7,index:n}),e+=g.length-1}n++}}static createElement(e,t){const r=_.createElement("template");return r.innerHTML=e,r}}function z(e,t,r=e,i){var n,s,o,a;if(t===M)return t;let l=void 0!==i?null===(n=r._$Cl)||void 0===n?void 0:n[i]:r._$Cu;const c=b(t)?void 0:t._$litDirective$;return(null==l?void 0:l.constructor)!==c&&(null===(s=null==l?void 0:l._$AO)||void 0===s||s.call(l,!1),void 0===c?l=void 0:(l=new c(e),l._$AT(e,r,i)),void 0!==i?(null!==(o=(a=r)._$Cl)&&void 0!==o?o:a._$Cl=[])[i]=l:r._$Cu=l),void 0!==l&&(t=z(e,l._$AS(e,t.values),l,i)),t}class j{constructor(e,t){this.v=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}p(e){var t;const{el:{content:r},parts:i}=this._$AD,n=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:_).importNode(r,!0);N.currentNode=n;let s=N.nextNode(),o=0,a=0,l=i[0];for(;void 0!==l;){if(o===l.index){let t;2===l.type?t=new D(s,s.nextSibling,this,e):1===l.type?t=new l.ctor(s,l.name,l.strings,this,e):6===l.type&&(t=new Q(s,this,e)),this.v.push(t),l=i[++a]}o!==(null==l?void 0:l.index)&&(s=N.nextNode(),o++)}return n}m(e){let t=0;for(const r of this.v)void 0!==r&&(void 0!==r.strings?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}}class D{constructor(e,t,r,i){var n;this.type=2,this._$AH=T,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=i,this._$Cg=null===(n=null==i?void 0:i.isConnected)||void 0===n||n}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cg}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=z(this,e,t),b(e)?e===T||null==e||""===e?(this._$AH!==T&&this._$AR(),this._$AH=T):e!==this._$AH&&e!==M&&this.$(e):void 0!==e._$litType$?this.T(e):void 0!==e.nodeType?this.S(e):(e=>{var t;return P(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])})(e)?this.M(e):this.$(e)}A(e,t=this._$AB){return this._$AA.parentNode.insertBefore(e,t)}S(e){this._$AH!==e&&(this._$AR(),this._$AH=this.A(e))}$(e){this._$AH!==T&&b(this._$AH)?this._$AA.nextSibling.data=e:this.S(_.createTextNode(e)),this._$AH=e}T(e){var t;const{values:r,_$litType$:i}=e,n="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=U.createElement(i.h,this.options)),i);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===n)this._$AH.m(r);else{const e=new j(n,this),t=e.p(this.options);e.m(r),this.S(t),this._$AH=e}}_$AC(e){let t=R.get(e.strings);return void 0===t&&R.set(e.strings,t=new U(e)),t}M(e){P(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let r,i=0;for(const n of e)i===t.length?t.push(r=new D(this.A(y()),this.A(y()),this,this.options)):r=t[i],r._$AI(n),i++;i<t.length&&(this._$AR(r&&r._$AB.nextSibling,i),t.length=i)}_$AR(e=this._$AA.nextSibling,t){var r;for(null===(r=this._$AP)||void 0===r||r.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cg=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class I{constructor(e,t,r,i,n){this.type=1,this._$AH=T,this._$AN=void 0,this.element=e,this.name=t,this._$AM=i,this.options=n,r.length>2||""!==r[0]||""!==r[1]?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=T}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,r,i){const n=this.strings;let s=!1;if(void 0===n)e=z(this,e,t,0),s=!b(e)||e!==this._$AH&&e!==M,s&&(this._$AH=e);else{const i=e;let o,a;for(e=n[0],o=0;o<n.length-1;o++)a=z(this,i[r+o],t,o),a===M&&(a=this._$AH[o]),s||(s=!b(a)||a!==this._$AH[o]),a===T?e=T:e!==T&&(e+=(null!=a?a:"")+n[o+1]),this._$AH[o]=a}s&&!i&&this.k(e)}k(e){e===T?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class B extends I{constructor(){super(...arguments),this.type=3}k(e){this.element[this.name]=e===T?void 0:e}}class K extends I{constructor(){super(...arguments),this.type=4}k(e){e&&e!==T?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class H extends I{constructor(e,t,r,i,n){super(e,t,r,i,n),this.type=5}_$AI(e,t=this){var r;if((e=null!==(r=z(this,e,t,0))&&void 0!==r?r:T)===M)return;const i=this._$AH,n=e===T&&i!==T||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,s=e!==T&&(i===T||n);n&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,r;"function"==typeof this._$AH?this._$AH.call(null!==(r=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==r?r:this.element,e):this._$AH.handleEvent(e)}}class Q{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){z(this,e)}}var W,F,V;null===(h=globalThis.litHtmlPolyfillSupport)||void 0===h||h.call(globalThis,U,D),(null!==(u=globalThis.litHtmlVersions)&&void 0!==u?u:globalThis.litHtmlVersions=[]).push("2.0.0");class X extends p{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var e,t;const r=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=r.firstChild),r}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Dt=O(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Dt)||void 0===e||e.setConnected(!1)}render(){return M}}X.finalized=!0,X._$litElement$=!0,null===(W=globalThis.litElementHydrateSupport)||void 0===W||W.call(globalThis,{LitElement:X}),null===(F=globalThis.litElementPolyfillSupport)||void 0===F||F.call(globalThis,{LitElement:X}),(null!==(V=globalThis.litElementVersions)&&void 0!==V?V:globalThis.litElementVersions=[]).push("3.0.0");const Y=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(r){r.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(r){r.createProperty(t.key,e)}};function J(e){return(t,r)=>void 0!==r?((e,t,r)=>{t.constructor.createProperty(r,e)})(e,t,r):Y(e,t)}const G=e=>(...t)=>({_$litDirective$:e,values:t});class Z{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,r){this._$Ct=e,this._$AM=t,this._$Ci=r}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const ee=G(class extends Z{constructor(e){var t;if(super(e),1!==e.type||"style"!==e.name||(null===(t=e.strings)||void 0===t?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(e){return Object.keys(e).reduce(((t,r)=>{const i=e[r];return null==i?t:t+`${r=r.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`}),"")}update(e,[t]){const{style:r}=e.element;if(void 0===this.ut){this.ut=new Set;for(const e in t)this.ut.add(e);return this.render(t)}this.ut.forEach((e=>{null==t[e]&&(this.ut.delete(e),e.includes("-")?r.removeProperty(e):r[e]="")}));for(const e in t){const i=t[e];null!=i&&(this.ut.add(e),e.includes("-")?r.setProperty(e,i):r[e]=i)}return M}}),te=e=>"string"==typeof e,re=e=>"function"==typeof e,ie=e=>JSON.parse(JSON.stringify(e)),ne=(e,t)=>{for(const[r,i]of Object.entries(t)){const t="{"+r+"}";for(;e.includes(t);)e=e.replace(t,i)}return e};console.assert("abc"===ne("abc",{a:"x"})),console.assert("{a}bc"===ne("{a}bc",{})),console.assert("{a}bc"===ne("{a}bc",{p:"q"})),console.assert("xbc"===ne("{a}bc",{a:"x"})),console.assert("xbcxbc"===ne("{a}bc{a}bc",{a:"x"})),console.assert("xxy"===ne("{a}{a}{b}",{a:"x",b:"y"}));const se=((e,...r)=>{const n=1===e.length?e[0]:r.reduce(((t,r,i)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+e[i+1]),e[0]);return new i(n,t)})`:host{display:block;position:relative;--light-color:#f0d9b5;--dark-color:#b58863;--highlight-color:yellow}[part~=board]{border:2px solid #404040;box-sizing:border-box;display:grid;grid-template-columns:repeat(8,12.5%);grid-template-rows:repeat(8,12.5%)}[part~=square]{position:relative;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.piece-image,[part~=piece]{width:100%;height:100%;z-index:10}[part~=spare-pieces]{display:grid;position:relative;padding:0 2px;grid-template-columns:repeat(8,12.5%)}[part~=dragged-piece]{display:none;position:absolute}[part~=white]{background-color:var(--light-color);color:var(--dark-color)}[part~=black]{background-color:var(--dark-color);color:var(--light-color)}[part~=highlight]{box-shadow:inset 0 0 3px 3px var(--highlight-color)}[part~=notation]{cursor:default;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:14px;position:absolute}[part~=alpha]{bottom:1px;right:3px}[part~=numeric]{top:2px;left:2px}`,oe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ae="abcdefgh".split(""),le=["wK","wQ","wR","wB","wN","wP"],ce=["bK","bQ","bR","bB","bN","bP"],pe=e=>e.charCodeAt(0)%2^e.charCodeAt(1)%2?"white":"black",he=e=>te(e)&&-1!==e.search(/^[a-h][1-8]$/),ue=e=>{if(!te(e))return!1;const t=e.split("-");return 2===t.length&&he(t[0])&&he(t[1])};console.assert(he("a1")),console.assert(he("e2")),console.assert(!he("D2")),console.assert(!he("g9")),console.assert(!he("a")),console.assert(!he(!0)),console.assert(!he(null)),console.assert(!he({}));const de=e=>te(e)&&-1!==e.search(/^[bw][KQRNBP]$/);console.assert(de("bP")),console.assert(de("bK")),console.assert(de("wK")),console.assert(de("wR")),console.assert(!de("WR")),console.assert(!de("Wr")),console.assert(!de("a")),console.assert(!de(!0)),console.assert(!de(null)),console.assert(!de({}));const fe=e=>{if(!te(e))return!1;const t=(e=(e=>e.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11"))(e=e.replace(/ .+$/,""))).split("/");if(8!==t.length)return!1;for(let e=0;e<8;e++)if(8!==t[e].length||-1!==t[e].search(/[^kqrnbpKQRNBP1]/))return!1;return!0};console.assert(fe(oe)),console.assert(fe("8/8/8/8/8/8/8/8")),console.assert(fe("r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R")),console.assert(fe("3r3r/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!fe("3r3z/1p4pp/2nb1k2/pP3p2/8/PB2PN2/p4PPP/R4RK1 b - - 0 1")),console.assert(!fe("anbqkbnr/8/8/8/8/8/PPPPPPPP/8")),console.assert(!fe("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/")),console.assert(!fe("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBN")),console.assert(!fe("888888/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!fe("888888/pppppppp/74/8/8/8/PPPPPPPP/RNBQKBNR")),console.assert(!fe({}));const ge=e=>{if("object"!=typeof e||null===e)return!1;for(const[t,r]of Object.entries(e))if(!he(t)||!de(r))return!1;return!0};console.assert(ge({})),console.assert(ge({e2:"wP"})),console.assert(ge({e2:"wP",d2:"wP"})),console.assert(!ge({e2:"BP"})),console.assert(!ge({y2:"wP"})),console.assert(!ge(null)),console.assert(!ge(void 0)),console.assert(!ge(1)),console.assert(!ge("start")),console.assert(!ge(oe));const ve=e=>{const t=e.split("");return"w"===t[0]?t[1].toUpperCase():t[1].toLowerCase()},me=e=>{if(!fe(e))return!1;const t=(e=e.replace(/ .+$/,"")).split("/"),r={};let i=8;for(let e=0;e<8;e++){const s=t[e].split("");let o=0;for(let e=0;e<s.length;e++)-1!==s[e].search(/[1-8]/)?o+=parseInt(s[e],10):(r[ae[o]+i]=(n=s[e]).toLowerCase()===n?"b"+n.toUpperCase():"w"+n.toUpperCase(),o+=1);i-=1}var n;return r},_e=me(oe),ye=e=>{if(!ge(e))return!1;let t="",r=8;for(let i=0;i<8;i++){for(let i=0;i<8;i++){const n=ae[i]+r;e.hasOwnProperty(n)?t+=ve(e[n]):t+="1"}7!==i&&(t+="/"),r-=1}return t=(e=>e.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2"))(t),t};console.assert(ye(_e)===oe),console.assert("8/8/8/8/8/8/8/8"===ye({})),console.assert("8/8/8/8/8/8/Pp6/8"===ye({a2:"wP",b2:"bP"}));const be=e=>null==e?{}:(te(e)&&"start"===e.toLowerCase()&&(e=ie(_e)),fe(e)&&(e=me(e)),e),Pe=(e,t)=>{const r=e.split(""),i=ae.indexOf(r[0])+1,n=parseInt(r[1],10),s=t.split(""),o=ae.indexOf(s[0])+1,a=parseInt(s[1],10),l=Math.abs(i-o),c=Math.abs(n-a);return l>=c?l:c},Ce=(e,t,r)=>{const i=(e=>{const t=[];for(let r=0;r<8;r++)for(let i=0;i<8;i++){const n=ae[r]+(i+1);e!==n&&t.push({square:n,distance:Pe(e,n)})}t.sort((function(e,t){return e.distance-t.distance}));const r=[];for(let e=0;e<t.length;e++)r.push(t[e].square);return r})(r);for(let r=0;r<i.length;r++){const n=i[r];if(e.hasOwnProperty(n)&&e[n]===t)return n}return!1},ke={bB:q`
    <g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;"> 
        <path
          d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />
        <path
          d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />
        <path
          d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />
      </g>
      <path
        d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"
        style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />
    </g>
  `,wB:q`
    <g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;"> 
        <path
          d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />
        <path
          d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />
        <path
          d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />
      </g>
      <path
        d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"
        style="fill:none; stroke:#000000; stroke-linejoin:miter;" />
    </g>
  `,bK:q`
    <g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 22.5,11.63 L 22.5,6"
        style="fill:none; stroke:#000000; stroke-linejoin:miter;"
        id="path6570" />
      <path
        d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"
        style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />
      <path
        d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "
        style="fill:#000000; stroke:#000000;" />
      <path
        d="M 20,8 L 25,8"
        style="fill:none; stroke:#000000; stroke-linejoin:miter;" />
      <path
        d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"
        style="fill:none; stroke:#ffffff;" />
      <path
        d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"
        style="fill:none; stroke:#ffffff;" />
    </g>
  `,wK:q`
    <g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 22.5,11.63 L 22.5,6"
        style="fill:none; stroke:#000000; stroke-linejoin:miter;" />
      <path
        d="M 20,8 L 25,8"
        style="fill:none; stroke:#000000; stroke-linejoin:miter;" />
      <path
        d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"
        style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />
      <path
        d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "
        style="fill:#ffffff; stroke:#000000;" />
      <path
        d="M 11.5,30 C 17,27 27,27 32.5,30"
        style="fill:none; stroke:#000000;" />
      <path
        d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"
        style="fill:none; stroke:#000000;" />
      <path
        d="M 11.5,37 C 17,34 27,34 32.5,37"
        style="fill:none; stroke:#000000;" />
    </g>
  `,bN:q`
    <g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"
        style="fill:#000000; stroke:#000000;" />
      <path
        d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"
        style="fill:#000000; stroke:#000000;" />
      <path
        d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"
        style="fill:#ffffff; stroke:#ffffff;" />
      <path
        d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"
        transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"
        style="fill:#ffffff; stroke:#ffffff;" />
      <path
        d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "
        style="fill:#ffffff; stroke:none;" />
    </g>
  `,wN:q`
    <g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"
        style="fill:#ffffff; stroke:#000000;" />
      <path
        d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"
        style="fill:#ffffff; stroke:#000000;" />
      <path
        d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"
        style="fill:#000000; stroke:#000000;" />
      <path
        d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"
        transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"
        style="fill:#000000; stroke:#000000;" />
    </g>
  `,bP:q`
    <path
      d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "
      style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" />
  `,wP:q`
    <path
      d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "
      style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" />
  `,bQ:q`
    <g style="opacity:1; fill:000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <g style="fill:#000000; stroke:none;">
        <circle cx="6"    cy="12" r="2.75" />
        <circle cx="14"   cy="9"  r="2.75" />
        <circle cx="22.5" cy="8"  r="2.75" />
        <circle cx="31"   cy="9"  r="2.75" />
        <circle cx="39"   cy="12" r="2.75" />
      </g>
      <path
        d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"
        style="stroke-linecap:butt; stroke:#000000;" />
      <path
        d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"
        style="stroke-linecap:butt;" />
      <path
        d="M 11,38.5 A 35,35 1 0 0 34,38.5"
        style="fill:none; stroke:#000000; stroke-linecap:butt;" />
      <path
        d="M 11,29 A 35,35 1 0 1 34,29"
        style="fill:none; stroke:#ffffff;" />
      <path
        d="M 12.5,31.5 L 32.5,31.5"
        style="fill:none; stroke:#ffffff;" />
      <path
        d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"
        style="fill:none; stroke:#ffffff;" />
      <path
        d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"
        style="fill:none; stroke:#ffffff;" />
    </g>
  `,wQ:q`
    <g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"
        transform="translate(-1,-1)" />
      <path
        d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"
        transform="translate(15.5,-5.5)" />
      <path
        d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"
        transform="translate(32,-1)" />
      <path
        d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"
        transform="translate(7,-4.5)" />
      <path
        d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"
        transform="translate(24,-4)" />
      <path
        d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 11.5,30 C 15,29 30,29 33.5,30"
        style="fill:none;" />
      <path
        d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"
        style="fill:none;" />
    </g>
  `,bR:q`
    <g style="opacity:1; fill:000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "
        style="stroke-linecap:butt;stroke-linejoin:miter;" />
      <path
        d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 12,35.5 L 33,35.5 L 33,35.5"
        style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />
      <path
        d="M 13,31.5 L 32,31.5"
        style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />
      <path
        d="M 14,29.5 L 31,29.5"
        style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />
      <path
        d="M 14,16.5 L 31,16.5"
        style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />
      <path
        d="M 11,14 L 34,14"
        style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />
    </g>
  `,wR:q`
    <g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">
      <path
        d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "
        style="stroke-linecap:butt;" />
      <path
        d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"
        style="stroke-linecap:butt;" />
      <path
        d="M 34,14 L 31,17 L 14,17 L 11,14" />
      <path
        d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"
        style="stroke-linecap:butt; stroke-linejoin:miter;" />
      <path
        d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />
      <path
        d="M 11,14 L 34,14"
        style="fill:none; stroke:#000000; stroke-linejoin:miter;" />
    </g>
  `};var we=function(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o};function $e(e){if("dragging"!==(null==e?void 0:e.state))throw Error("unexpected drag state "+JSON.stringify(e))}const Se=e=>"number"==typeof e?e:"fast"===e?200:"slow"===e?600:parseInt(e,10),Ae=e=>"square-"+e,Ee=e=>"spare-piece-"+e,Le=G(class extends Z{render(e,t){return T}update(e,[t,r]){return re(r)?r(t,e.element):e.element.replaceChildren(),M}});let xe=class extends X{constructor(){super(...arguments),this.hideNotation=!1,this.orientation="white",this.draggablePieces=!1,this.dropOffBoard="snapback",this.renderPiece=(e,t)=>{let r;te(this.pieceTheme)?r=ne(this.pieceTheme,{piece:e}):re(this.pieceTheme)&&(r=this.pieceTheme(e)),void 0===r?((e,t)=>{O(x`<svg class="piece-image" viewBox="0 0 45 45">${ke[e]}</svg>`,t)})(e,t):O(x`<img class="piece-image" src="${r}">`,t)},this.moveSpeed=200,this.snapbackSpeed=60,this.snapSpeed=30,this.trashSpeed=100,this.appearSpeed=200,this.sparePieces=!1,this._highlightedSquares=new Set,this._animations=new Map,this._currentPosition={},this._mousemoveWindow=e=>{var t;if("dragging"!==(null===(t=this._dragState)||void 0===t?void 0:t.state))return;e.preventDefault();const r=e instanceof MouseEvent?e:e.changedTouches[0];this._updateDraggedPiece(r.clientX,r.clientY)},this._mouseupWindow=e=>{var t;if("dragging"!==(null===(t=this._dragState)||void 0===t?void 0:t.state))return;const r=e instanceof MouseEvent?e:e.changedTouches[0],i=this._isXYOnSquare(r.clientX,r.clientY);this._stopDraggedPiece(i)}}get position(){return this._currentPosition}set position(e){const t=this._currentPosition;this._setCurrentPosition(e),this.requestUpdate("position",t)}get showNotation(){return!this.hideNotation}set showNotation(e){this.hideNotation=!e}get _squareSize(){return this.offsetWidth/8}_getSquareElement(e){return this.shadowRoot.getElementById(Ae(e))}_getSparePieceElement(e){return this.shadowRoot.getElementById(Ee(e))}render(){return x`<div part="spare-pieces">${this._renderSparePieces("white"===this.orientation?"black":"white")}</div>${this._renderBoard()}<div part="spare-pieces">${this._renderSparePieces("white"===this.orientation?"white":"black")}</div><div part="dragged-pieces" id="dragged-pieces" style="${ee({width:this._squareSize+"px",height:this._squareSize+"px"})}">${this._renderDraggedPiece()}</div>`}_renderSparePieces(e){return this.sparePieces?x`<div></div>${("black"===e?ce:le).map((e=>x`<div id="spare-${e}" @mousedown="${this._mousedownSparePiece}" @touchstart="${this._mousedownSparePiece}">${this._renderPiece(e,{},!1,Ee(e))}</div>`))}<div></div>`:T}_renderDraggedPiece(){var e,t;const r={height:this._squareSize+"px",width:this._squareSize+"px"},i=this._dragState;if(void 0!==i){r.display="block";const e=this.getBoundingClientRect();if("dragging"===i.state){const{x:t,y:n}=i;Object.assign(r,{top:n-e.top-this._squareSize/2+"px",left:t-e.left-this._squareSize/2+"px"})}else if("snapback"===i.state){const{source:t}=i,n=this._getSquareElement(t).getBoundingClientRect();Object.assign(r,{transitionProperty:"top, left",transitionDuration:Se(this.snapbackSpeed)+"ms",top:n.top-e.top+"px",left:n.left-e.left+"px"})}else if("trash"===i.state){const{x:t,y:n}=i;Object.assign(r,{transitionProperty:"opacity",transitionDuration:Se(this.trashSpeed)+"ms",opacity:"0",top:n-e.top-this._squareSize/2+"px",left:t-e.left-this._squareSize/2+"px"})}else if("snap"===i.state){const t=this._getSquareElement(i.location).getBoundingClientRect();Object.assign(r,{transitionProperty:"top, left",transitionDuration:Se(this.snapSpeed)+"ms",top:t.top-e.top+"px",left:t.left-e.left+"px"})}}return this._renderPiece(null!==(t=null===(e=this._dragState)||void 0===e?void 0:e.piece)&&void 0!==t?t:"",r,!1,void 0,"dragged-piece")}_renderBoard(){var e;const t=[],r="black"===this.orientation;for(let i=0;i<8;i++)for(let n=0;n<8;n++){const s=ae[r?7-n:n],o=r?i+1:8-i,a=`${s}${o}`,l=pe(a);let c=this._currentPosition[a];const p=a===(null===(e=this._dragState)||void 0===e?void 0:e.source),h=this._animations.get(a),u=p||this._highlightedSquares.has(a)?"highlight":"",d=this._getAnimationStyles(c,h);c||"clear"!==(null==h?void 0:h.type)||(c=h.piece),t.push(x`<div class="square" id="${Ae(a)}" data-square="${a}" part="square ${a} ${l} ${u}" @mousedown="${this._mousedownSquare}" @mouseenter="${this._mouseenterSquare}" @mouseleave="${this._mouseleaveSquare}" @touchstart="${this._mousedownSquare}">${this.showNotation&&7===i?x`<div part="notation alpha">${s}</div>`:T} ${this.showNotation&&0===n?x`<div part="notation numeric">${o}</div>`:T} ${this._renderPiece(c,d,p)}</div>`)}const i={width:8*this._squareSize+"px",height:8*this._squareSize+"px"};return x`<div part="board" style="${ee(i)}">${t}</div>`}_renderPiece(e,t,r,i,n){if(void 0===e)return T;const s=Object.assign({opacity:"1",transitionProperty:"",transitionDuration:"0ms"},t);return(r||""===e)&&(s.display="none"),""===e?T:(re(this.renderPiece)||this._error(8272,"invalid renderPiece."),x`<div id="${(e=>null!=e?e:T)(i)}" part="piece ${null!=n?n:""}" piece="${e}" style="${ee(s)}" ...="${Le(e,this.renderPiece)}"></div>`)}_getAnimationStyles(e,t){if(t){if(e&&("move-start"===t.type||"add-start"===t.type&&this.draggablePieces)){const r="move-start"===t.type?this._getSquareElement(t.source):this._getSparePieceElement(e),i="move-start"===t.type?this._getSquareElement(t.destination):this._getSquareElement(t.square),n=r.getBoundingClientRect(),s=i.getBoundingClientRect();return{position:"absolute",left:n.left-s.left+"px",top:n.top-s.top+"px",width:this._squareSize+"px",height:this._squareSize+"px"}}if(e&&("move"===t.type||"add"===t.type&&this.draggablePieces))return{position:"absolute",transitionProperty:"top, left",transitionDuration:Se(this.moveSpeed)+"ms",top:"0",left:"0",width:this._squareSize+"px",height:this._squareSize+"px"};if(!e&&"clear"===t.type)return e=t.piece,{transitionProperty:"opacity",transitionDuration:Se(this.trashSpeed)+"ms",opacity:"0"};if(e&&"add-start"===t.type)return{opacity:"0"};if(e&&"add"===t.type)return{transitionProperty:"opacity",transitionDuration:Se(this.appearSpeed)+"ms"}}return{}}_mousedownSquare(e){if(!this.draggablePieces&&!this.sparePieces)return;const t=e.currentTarget.getAttribute("data-square");if(null===t||!this._currentPosition.hasOwnProperty(t))return;e.preventDefault();const r=e instanceof MouseEvent?e:e.changedTouches[0];this._beginDraggingPiece(t,this._currentPosition[t],r.clientX,r.clientY)}_mousedownSparePiece(e){if(!this.sparePieces)return;const t=e.currentTarget.querySelector("[part~=piece]").getAttribute("piece");e.preventDefault();const r=e instanceof MouseEvent?e:e.changedTouches[0];this._beginDraggingPiece("spare",t,r.clientX,r.clientY)}_mouseenterSquare(e){if(void 0!==this._dragState)return;const t=e.currentTarget.getAttribute("data-square");if(!he(t))return;const r=this._currentPosition.hasOwnProperty(t)&&this._currentPosition[t];this.dispatchEvent(new CustomEvent("mouseover-square",{bubbles:!0,detail:{square:t,piece:r,position:ie(this._currentPosition),orientation:this.orientation}}))}_mouseleaveSquare(e){if(void 0!==this._dragState)return;const t=e.currentTarget.getAttribute("data-square");if(!he(t))return;const r=this._currentPosition.hasOwnProperty(t)&&this._currentPosition[t];this.dispatchEvent(new CustomEvent("mouseout-square",{bubbles:!0,detail:{square:t,piece:r,position:ie(this._currentPosition),orientation:this.orientation}}))}setPosition(e,t=!0){if(e=be(e),!ge(e))throw this._error(6482,"Invalid value passed to the position method.",e);if(t){const t=this._calculateAnimations(this._currentPosition,e);this._doAnimations(t,this._currentPosition,e)}this._setCurrentPosition(e),this.requestUpdate()}fen(){return ye(this._currentPosition)}start(e){this.setPosition("start",e)}clear(e){this.setPosition({},e)}move(...e){let t=!0;const r={};for(const i of e){if(!1===i){t=!1;continue}if(!ue(i)){this._error(2826,"Invalid move passed to the move method.",i);continue}const[e,n]=i.split("-");r[e]=n}const i=((e,t)=>{const r=ie(e);for(const e in t){if(!t.hasOwnProperty(e))continue;if(!r.hasOwnProperty(e))continue;const i=r[e];delete r[e],r[t[e]]=i}return r})(this._currentPosition,r);return this.setPosition(i,t),i}flip(){this.orientation="white"===this.orientation?"black":"white"}resize(){this.requestUpdate()}firstUpdated(){this.requestUpdate(),void 0!==window.ResizeObserver&&new ResizeObserver((()=>{this.resize()})).observe(this)}connectedCallback(){super.connectedCallback(),window.addEventListener("mousemove",this._mousemoveWindow),window.addEventListener("mouseup",this._mouseupWindow),window.addEventListener("touchmove",this._mousemoveWindow,{passive:!1}),window.addEventListener("touchend",this._mouseupWindow,{passive:!1})}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("mousemove",this._mousemoveWindow),window.removeEventListener("mouseup",this._mouseupWindow),window.removeEventListener("touchmove",this._mousemoveWindow),window.removeEventListener("touchend",this._mouseupWindow)}_setCurrentPosition(e){const t=ie(this._currentPosition),r=ie(e);ye(t)!==ye(r)&&(this.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:{value:r,oldValue:t}})),this._currentPosition=e)}_isXYOnSquare(e,t){const r=this.shadowRoot.elementsFromPoint(e,t).find((e=>e.classList.contains("square")));return void 0===r?"offboard":r.getAttribute("data-square")}_highlightSquare(e,t=!0){t?this._highlightedSquares.add(e):this._highlightedSquares.delete(e),this.requestUpdate("_highlightedSquares")}async _snapbackDraggedPiece(){$e(this._dragState);const{source:e,piece:t}=this._dragState;return"spare"===e?this._trashDraggedPiece():(this._dragState={state:"snapback",piece:t,source:e},this.requestUpdate(),await new Promise((e=>setTimeout(e,0))),new Promise((r=>{const i=()=>{this._draggedPieceElement.removeEventListener("transitionend",i),r(),this.dispatchEvent(new CustomEvent("snapback-end",{bubbles:!0,detail:{piece:t,square:e,position:ie(this._currentPosition),orientation:this.orientation}}))};this._draggedPieceElement.addEventListener("transitionend",i)})))}async _trashDraggedPiece(){$e(this._dragState);const{source:e,piece:t}=this._dragState,r=ie(this._currentPosition);return delete r[e],this._setCurrentPosition(r),this._dragState={state:"trash",piece:t,x:this._dragState.x,y:this._dragState.y,source:this._dragState.source},this.requestUpdate(),await new Promise((e=>setTimeout(e,0))),new Promise((e=>{const t=()=>{this._draggedPieceElement.removeEventListener("transitionend",t),e()};this._draggedPieceElement.addEventListener("transitionend",t)}))}async _dropDraggedPieceOnSquare(e){$e(this._dragState);const{source:t,piece:r}=this._dragState,i=ie(this._currentPosition);return delete i[t],i[e]=r,this._setCurrentPosition(i),this._dragState={state:"snap",piece:r,location:e,source:e},this.requestUpdate(),await new Promise((e=>setTimeout(e,0))),new Promise((i=>{const n=()=>{this._draggedPieceElement.removeEventListener("transitionend",n),i(),this.dispatchEvent(new CustomEvent("snap-end",{bubbles:!0,detail:{source:t,square:e,piece:r}}))};this._draggedPieceElement.addEventListener("transitionend",n)}))}_beginDraggingPiece(e,t,r,i){const n=new CustomEvent("drag-start",{bubbles:!0,cancelable:!0,detail:{source:e,piece:t,position:ie(this._currentPosition),orientation:this.orientation}});this.dispatchEvent(n),n.defaultPrevented||(this._dragState={state:"dragging",x:r,y:i,piece:t,location:"spare"===e?"offboard":e,source:e},this.requestUpdate())}_updateDraggedPiece(e,t){$e(this._dragState),this._dragState.x=e,this._dragState.y=t,this.requestUpdate();const r=this._isXYOnSquare(e,t);r!==this._dragState.location&&(he(this._dragState.location)&&this._highlightSquare(this._dragState.location,!1),he(r)&&this._highlightSquare(r),this.dispatchEvent(new CustomEvent("drag-move",{bubbles:!0,detail:{newLocation:r,oldLocation:this._dragState.location,source:this._dragState.source,piece:this._dragState.piece,position:ie(this._currentPosition),orientation:this.orientation}})),this._dragState.location=r)}async _stopDraggedPiece(e){$e(this._dragState);const{source:t,piece:r}=this._dragState;let i="drop";"offboard"===e&&(i="trash"===this.dropOffBoard?"trash":"snapback");const n=ie(this._currentPosition),s=ie(this._currentPosition);"spare"===t&&he(e)&&(n[e]=r),he(t)&&(delete n[t],he(e)&&(n[e]=r));const o=new CustomEvent("drop",{bubbles:!0,detail:{source:t,target:e,piece:r,newPosition:n,oldPosition:s,orientation:this.orientation,setAction(e){i=e}}});this.dispatchEvent(o),this._highlightedSquares.clear(),"snapback"===i?await this._snapbackDraggedPiece():"trash"===i?await this._trashDraggedPiece():"drop"===i&&await this._dropDraggedPieceOnSquare(e),this._dragState=void 0,this.requestUpdate()}_calculateAnimations(e,t){e=ie(e),t=ie(t);const r=[],i={};for(const r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&e[r]===t[r]&&(delete e[r],delete t[r]);for(const n in t){if(!t.hasOwnProperty(n))continue;const s=Ce(e,t[n],n);s&&(r.push({type:"move",source:s,destination:n,piece:t[n]}),delete e[s],delete t[n],i[n]=!0)}for(const e in t)t.hasOwnProperty(e)&&(r.push({type:"add",square:e,piece:t[e]}),delete t[e]);for(const t in e)e.hasOwnProperty(t)&&(i.hasOwnProperty(t)||(r.push({type:"clear",square:t,piece:e[t]}),delete e[t]));return r}async _doAnimations(e,t,r){if(0===e.length)return;let i=0;const n=()=>{i++,i===e.length&&(this.shadowRoot.removeEventListener("transitionend",n),this._animations.clear(),this.requestUpdate(),this.dispatchEvent(new CustomEvent("move-end",{bubbles:!0,detail:{oldPosition:ie(t),newPosition:ie(r)}})))};this.shadowRoot.addEventListener("transitionend",n),this._animations.clear();for(const t of e)"add"===t.type||"add-start"===t.type?this._animations.set(t.square,Object.assign(Object.assign({},t),{type:"add-start"})):"move"===t.type||"move-start"===t.type?this._animations.set(t.destination,Object.assign(Object.assign({},t),{type:"move-start"})):this._animations.set(t.square,t);this.requestUpdate(),await new Promise((e=>setTimeout(e,0))),this._animations.clear();for(const t of e)"move"===t.type||"move-start"===t.type?this._animations.set(t.destination,t):this._animations.set(t.square,t);this.requestUpdate()}_error(e,t,r){const i=`Chessboard Error ${e} : ${t}`;return this.dispatchEvent(new ErrorEvent("error",{message:i})),Error(i)}};xe.styles=se,we([J({converter:e=>be(e)})],xe.prototype,"position",null),we([J({attribute:"hide-notation",type:Boolean})],xe.prototype,"hideNotation",void 0),we([J()],xe.prototype,"orientation",void 0),we([J({attribute:"draggable-pieces",type:Boolean})],xe.prototype,"draggablePieces",void 0),we([J({attribute:"drop-off-board"})],xe.prototype,"dropOffBoard",void 0),we([J({attribute:"piece-theme"})],xe.prototype,"pieceTheme",void 0),we([J({attribute:!1})],xe.prototype,"renderPiece",void 0),we([J({attribute:"move-speed"})],xe.prototype,"moveSpeed",void 0),we([J({attribute:"snapback-speed"})],xe.prototype,"snapbackSpeed",void 0),we([J({attribute:"snap-speed"})],xe.prototype,"snapSpeed",void 0),we([J({attribute:"trash-speed"})],xe.prototype,"trashSpeed",void 0),we([J({attribute:"appear-speed"})],xe.prototype,"appearSpeed",void 0),we([J({attribute:"spare-pieces",type:Boolean})],xe.prototype,"sparePieces",void 0),we([function(e,t){return(({finisher:e,descriptor:t})=>(r,i)=>{var n;if(void 0===i){const i=null!==(n=r.originalKey)&&void 0!==n?n:r.key,s=null!=t?{kind:"method",placement:"prototype",key:i,descriptor:t(r.key)}:{...r,key:i};return null!=e&&(s.finisher=function(t){e(t,i)}),s}{const n=r.constructor;void 0!==t&&Object.defineProperty(r,i,t(i)),null==e||e(n,i)}})({descriptor:t=>{const r={get(){var t,r;return null!==(r=null===(t=this.renderRoot)||void 0===t?void 0:t.querySelector(e))&&void 0!==r?r:null},enumerable:!0,configurable:!0};return r}})}('[part~="dragged-piece"]')],xe.prototype,"_draggedPieceElement",void 0),xe=we([e=>"function"==typeof e?((e,t)=>(window.customElements.define("chess-board",t),t))(0,e):((e,t)=>{const{kind:r,elements:i}=t;return{kind:r,elements:i,finisher(e){window.customElements.define("chess-board",e)}}})(0,e)],xe);const qe="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Me=["1-0","0-1","1/2-1/2","*"],Te={b:[16,32,17,15],w:[-16,-32,-17,-15]},Re={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Oe=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ne=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ue={p:0,n:1,b:2,r:3,q:4,k:5},ze={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},je={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},De={w:[{square:je.a1,flag:ze.QSIDE_CASTLE},{square:je.h1,flag:ze.KSIDE_CASTLE}],b:[{square:je.a8,flag:ze.QSIDE_CASTLE},{square:je.h8,flag:ze.KSIDE_CASTLE}]};function Ie(e){var t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return Ge}return"o"===(t=t.toLowerCase())?Ze:t}function Be(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Ke(e){return e>>4}function He(e){return 15&e}function Qe(e){var t=He(e),r=Ke(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function We(e){return e===Je?Ye:Je}function Fe(e){return-1!=="0123456789".indexOf(e)}function Ve(e){var t=e instanceof Array?[]:{};for(var r in e)t[r]="object"==typeof r?Ve(e[r]):e[r];return t}function Xe(e){return e.replace(/^\s+|\s+$/g,"")}const Ye="b",Je="w",Ge="p",Ze="k";!function(){for(var e=[],t=je.a8;t<=je.h1;t++)136&t?t+=7:e.push(Qe(t))}();const et={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},tt=function(e){var t=new Array(128),r={w:-1,b:-1},i=Je,n={w:0,b:0},s=-1,o=0,a=1,l=[],c={},p={};function h(e){void 0===e&&(e=!1),t=new Array(128),r={w:-1,b:-1},i=Je,n={w:0,b:0},s=-1,o=0,a=1,l=[],e||(c={}),p={},_(v())}function u(){for(var e=[],t={},r=function(e){e in p&&(t[e]=p[e])};l.length>0;)e.push(M());for(r(v());e.length>0;)q(e.pop()),r(v());p=t}function d(){f(qe)}function f(e,t){void 0===t&&(t=!1);var r=e.split(/\s+/),l=r[0],c=0;if(!g(e).valid)return!1;h(t);for(var p=0;p<l.length;p++){var u=l.charAt(p);if("/"===u)c+=8;else if(Fe(u))c+=parseInt(u,10);else{var d=u<"a"?Je:Ye;b({type:u.toLowerCase(),color:d},Qe(c)),c++}}return i=r[1],r[2].indexOf("K")>-1&&(n.w|=ze.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(n.w|=ze.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(n.b|=ze.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(n.b|=ze.QSIDE_CASTLE),s="-"===r[3]?-1:je[r[3]],o=parseInt(r[4],10),a=parseInt(r[5],10),_(v()),!0}function g(e){var t="No errors.",r="FEN string must contain six space-delimited fields.",i="6th field (move number) must be a positive integer.",n="5th field (half move counter) must be a non-negative integer.",s="4th field (en-passant square) is invalid.",o="3rd field (castling availability) is invalid.",a="2nd field (side to move) is invalid.",l="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",p="1st field (piece positions) is invalid [invalid piece].",h="1st field (piece positions) is invalid [row too large].",u="Illegal en-passant square",d=e.split(/\s+/);if(6!==d.length)return{valid:!1,error_number:1,error:r};if(isNaN(parseInt(d[5]))||parseInt(d[5],10)<=0)return{valid:!1,error_number:2,error:i};if(isNaN(parseInt(d[4]))||parseInt(d[4],10)<0)return{valid:!1,error_number:3,error:n};if(!/^(-|[abcdefgh][36])$/.test(d[3]))return{valid:!1,error_number:4,error:s};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(d[2]))return{valid:!1,error_number:5,error:o};if(!/^(w|b)$/.test(d[1]))return{valid:!1,error_number:6,error:a};var f=d[0].split("/");if(8!==f.length)return{valid:!1,error_number:7,error:l};for(var g=0;g<f.length;g++){for(var v=0,m=!1,_=0;_<f[g].length;_++)if(isNaN(f[g][_])){if(!/^[prnbqkPRNBQK]$/.test(f[g][_]))return{valid:!1,error_number:9,error:p};v+=1,m=!1}else{if(m)return{valid:!1,error_number:8,error:c};v+=parseInt(f[g][_],10),m=!0}if(8!==v)return{valid:!1,error_number:10,error:h}}return"3"==d[3][1]&&"w"==d[1]||"6"==d[3][1]&&"b"==d[1]?{valid:!1,error_number:11,error:u}:{valid:!0,error_number:0,error:t}}function v(){for(var e=0,r="",l=je.a8;l<=je.h1;l++){if(null==t[l])e++;else{e>0&&(r+=e,e=0);var c=t[l].color,p=t[l].type;r+=c===Je?p.toUpperCase():p.toLowerCase()}l+1&136&&(e>0&&(r+=e),l!==je.h1&&(r+="/"),e=0,l+=8)}var h="";n[Je]&ze.KSIDE_CASTLE&&(h+="K"),n[Je]&ze.QSIDE_CASTLE&&(h+="Q"),n[Ye]&ze.KSIDE_CASTLE&&(h+="k"),n[Ye]&ze.QSIDE_CASTLE&&(h+="q"),h=h||"-";var u=-1===s?"-":Qe(s);return[r,i,h,u,o,a].join(" ")}function m(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(c[e[t]]=e[t+1]);return c}function _(e){l.length>0||(e!==qe?(c.SetUp="1",c.FEN=e):(delete c.SetUp,delete c.FEN))}function y(e){var r=t[je[e]];return r?{type:r.type,color:r.color}:null}function b(e,i){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(i in je))return!1;var n=je[i];return(e.type!=Ze||-1==r[e.color]||r[e.color]==n)&&(t[n]={type:e.type,color:e.color},e.type===Ze&&(r[e.color]=n),_(v()),!0)}function P(e,t,r,n,s){var o={color:i,from:t,to:r,flags:n,piece:e[t].type};return s&&(o.flags|=ze.PROMOTION,o.promotion=s),e[r]?o.captured=e[r].type:n&ze.EP_CAPTURE&&(o.captured=Ge),o}function C(e){function o(e,t,r,i,n){if(e[r].type!==Ge||0!==Ke(i)&&7!==Ke(i))t.push(P(e,r,i,n));else for(var s=["q","r","b","n"],o=0,a=s.length;o<a;o++)t.push(P(e,r,i,n,s[o]))}var a=[],l=i,c=We(l),p={b:1,w:6},h=je.a8,u=je.h1,d=!1,f=void 0===e||!("legal"in e)||e.legal,g=void 0===e||!("piece"in e)||"string"!=typeof e.piece||e.piece.toLowerCase();if(void 0!==e&&"square"in e){if(!(e.square in je))return[];h=u=je[e.square],d=!0}for(var v=h;v<=u;v++)if(136&v)v+=7;else{var m=t[v];if(null!=m&&m.color===l)if(m.type!==Ge||!0!==g&&g!==Ge){if(!0===g||g===m.type)for(var _=0,y=Re[m.type].length;_<y;_++){var b=Re[m.type][_];for(C=v;!(136&(C+=b));){if(null!=t[C]){if(t[C].color===l)break;o(t,a,v,C,ze.CAPTURE);break}if(o(t,a,v,C,ze.NORMAL),"n"===m.type||"k"===m.type)break}}}else{var C=v+Te[l][0];if(null==t[C]){o(t,a,v,C,ze.NORMAL);var C=v+Te[l][1];p[l]===Ke(v)&&null==t[C]&&o(t,a,v,C,ze.BIG_PAWN)}for(_=2;_<4;_++){136&(C=v+Te[l][_])||(null!=t[C]&&t[C].color===c?o(t,a,v,C,ze.CAPTURE):C===s&&o(t,a,v,s,ze.EP_CAPTURE))}}}if(!(!0!==g&&g!==Ze||d&&u!==r[l])){if(n[l]&ze.KSIDE_CASTLE){var k=(S=r[l])+2;null!=t[S+1]||null!=t[k]||w(c,r[l])||w(c,S+1)||w(c,k)||o(t,a,r[l],k,ze.KSIDE_CASTLE)}if(n[l]&ze.QSIDE_CASTLE){var S;k=(S=r[l])-2;null!=t[S-1]||null!=t[S-2]||null!=t[S-3]||w(c,r[l])||w(c,S-1)||w(c,k)||o(t,a,r[l],k,ze.QSIDE_CASTLE)}}if(!f)return a;var A=[];for(v=0,y=a.length;v<y;v++)q(a[v]),$(l)||A.push(a[v]),M();return A}function k(e,t){var r="";if(e.flags&ze.KSIDE_CASTLE)r="O-O";else if(e.flags&ze.QSIDE_CASTLE)r="O-O-O";else{if(e.piece!==Ge){var i=function(e,t){for(var r=e.from,i=e.to,n=e.piece,s=0,o=0,a=0,l=0,c=t.length;l<c;l++){var p=t[l].from,h=t[l].to;n===t[l].piece&&r!==p&&i===h&&(s++,Ke(r)===Ke(p)&&o++,He(r)===He(p)&&a++)}return s>0?o>0&&a>0?Qe(r):a>0?Qe(r).charAt(1):Qe(r).charAt(0):""}(e,t);r+=e.piece.toUpperCase()+i}e.flags&(ze.CAPTURE|ze.EP_CAPTURE)&&(e.piece===Ge&&(r+=Qe(e.from)[0]),r+="x"),r+=Qe(e.to),e.flags&ze.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return q(e),S()&&(A()?r+="#":r+="+"),M(),r}function w(e,r){for(var i=je.a8;i<=je.h1;i++)if(136&i)i+=7;else if(null!=t[i]&&t[i].color===e){var n=t[i],s=i-r,o=s+119;if(Oe[o]&1<<Ue[n.type]){if(n.type===Ge){if(s>0){if(n.color===Je)return!0}else if(n.color===Ye)return!0;continue}if("n"===n.type||"k"===n.type)return!0;for(var a=Ne[o],l=i+a,c=!1;l!==r;){if(null!=t[l]){c=!0;break}l+=a}if(!c)return!0}}return!1}function $(e){return w(We(e),r[e])}function S(){return $(i)}function A(){return S()&&0===C().length}function E(){return!S()&&0===C().length}function L(){for(var e={},r=[],i=0,n=0,s=je.a8;s<=je.h1;s++)if(n=(n+1)%2,136&s)s+=7;else{var o=t[s];o&&(e[o.type]=o.type in e?e[o.type]+1:1,"b"===o.type&&r.push(n),i++)}if(2===i)return!0;if(3===i&&(1===e.b||1===e.n))return!0;if(i===e.b+2){var a=0,l=r.length;for(s=0;s<l;s++)a+=r[s];if(0===a||a===l)return!0}return!1}function x(){for(var e=[],t={},r=!1;;){var i=M();if(!i)break;e.push(i)}for(;;){var n=v().split(" ").slice(0,4).join(" ");if(t[n]=n in t?t[n]+1:1,t[n]>=3&&(r=!0),!e.length)break;q(e.pop())}return r}function q(e){var c=i,p=We(c);if(function(e){l.push({move:e,kings:{b:r.b,w:r.w},turn:i,castling:{b:n.b,w:n.w},ep_square:s,half_moves:o,move_number:a})}(e),t[e.to]=t[e.from],t[e.from]=null,e.flags&ze.EP_CAPTURE&&(i===Ye?t[e.to-16]=null:t[e.to+16]=null),e.flags&ze.PROMOTION&&(t[e.to]={type:e.promotion,color:c}),t[e.to].type===Ze){if(r[t[e.to].color]=e.to,e.flags&ze.KSIDE_CASTLE){var h=e.to-1,u=e.to+1;t[h]=t[u],t[u]=null}else if(e.flags&ze.QSIDE_CASTLE){h=e.to+1,u=e.to-2;t[h]=t[u],t[u]=null}n[c]=""}if(n[c])for(var d=0,f=De[c].length;d<f;d++)if(e.from===De[c][d].square&&n[c]&De[c][d].flag){n[c]^=De[c][d].flag;break}if(n[p])for(d=0,f=De[p].length;d<f;d++)if(e.to===De[p][d].square&&n[p]&De[p][d].flag){n[p]^=De[p][d].flag;break}s=e.flags&ze.BIG_PAWN?"b"===i?e.to-16:e.to+16:-1,e.piece===Ge||e.flags&(ze.CAPTURE|ze.EP_CAPTURE)?o=0:o++,i===Ye&&a++,i=We(i)}function M(){var e=l.pop();if(null==e)return null;var c=e.move;r=e.kings,i=e.turn,n=e.castling,s=e.ep_square,o=e.half_moves,a=e.move_number;var p,h,u=i,d=We(i);if(t[c.from]=t[c.to],t[c.from].type=c.piece,t[c.to]=null,c.flags&ze.CAPTURE)t[c.to]={type:c.captured,color:d};else if(c.flags&ze.EP_CAPTURE){var f;f=u===Ye?c.to-16:c.to+16,t[f]={type:Ge,color:d}}c.flags&(ze.KSIDE_CASTLE|ze.QSIDE_CASTLE)&&(c.flags&ze.KSIDE_CASTLE?(p=c.to+1,h=c.to-1):c.flags&ze.QSIDE_CASTLE&&(p=c.to-2,h=c.to+1),t[p]=t[h],t[h]=null);return c}function T(e,t){for(var r=Be(e),i=0;i<2;i++){if(1==i){if(!t)return null;var n=!1;if(c=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/)){var s=c[1],o=c[2],a=c[3],l=c[4];1==o.length&&(n=!0)}else{var c;if(c=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/)){s=c[1],o=c[2],a=c[3],l=c[4];if(1==o.length)n=!0}}}for(var p=Ie(r),h=C({legal:!0,piece:s||p}),u=0,d=h.length;u<d;u++)switch(i){case 0:if(r===Be(k(h[u],h)))return h[u];break;case 1:if(c){if(!(s&&s.toLowerCase()!=h[u].piece||je[o]!=h[u].from||je[a]!=h[u].to||l&&l.toLowerCase()!=h[u].promotion))return h[u];if(n){var f=Qe(h[u].from);if(!(s&&s.toLowerCase()!=h[u].piece||je[a]!=h[u].to||o!=f[0]&&o!=f[1]||l&&l.toLowerCase()!=h[u].promotion))return h[u]}}}}return null}function R(e){var t=Ve(e);t.san=k(t,C({legal:!0})),t.to=Qe(t.to),t.from=Qe(t.from);var r="";for(var i in ze)ze[i]&t.flags&&(r+=et[i]);return t.flags=r,t}function O(e){for(var t=C({legal:!1}),r=0,n=i,s=0,o=t.length;s<o;s++){if(q(t[s]),!$(n))if(e-1>0)r+=O(e-1);else r++;M()}return r}return f(void 0===e?qe:e),{load:function(e){return f(e)},reset:function(){return d()},moves:function(e){for(var t=C(e),r=[],i=0,n=t.length;i<n;i++)void 0!==e&&"verbose"in e&&e.verbose?r.push(R(t[i])):r.push(k(t[i],C({legal:!0})));return r},in_check:function(){return S()},in_checkmate:function(){return A()},in_stalemate:function(){return E()},in_draw:function(){return o>=100||E()||L()||x()},insufficient_material:function(){return L()},in_threefold_repetition:function(){return x()},game_over:function(){return o>=100||A()||E()||L()||x()},validate_fen:function(e){return g(e)},fen:function(){return v()},board:function(){for(var e=[],r=[],i=je.a8;i<=je.h1;i++)null==t[i]?r.push(null):r.push({square:Qe(i),type:t[i].type,color:t[i].color}),i+1&136&&(e.push(r),r=[],i+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],n=!1;for(var s in c)i.push("["+s+' "'+c[s]+'"]'+t),n=!0;n&&l.length&&i.push(t);for(var o=function(e){var t=p[v()];void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`);return e},h=[];l.length>0;)h.push(M());var u=[],d="";for(0===h.length&&u.push(o(""));h.length>0;){d=o(d);var f=h.pop();if(l.length||"b"!==f.color)"w"===f.color&&(d.length&&u.push(d),d=a+".");else{const e=`${a}. ...`;d=d?`${d} ${e}`:e}d=d+" "+k(f,C({legal:!0})),q(f)}if(d.length&&u.push(o(d)),void 0!==c.Result&&u.push(c.Result),0===r)return i.join("")+u.join(" ");var g=function(){return i.length>0&&" "===i[i.length-1]&&(i.pop(),!0)},m=function(e,n){for(var s of n.split(" "))if(s){if(e+s.length>r){for(;g();)e--;i.push(t),e=0}i.push(s),e+=s.length,i.push(" "),e++}return g()&&e--,e},_=0;for(s=0;s<u.length;s++)_+u[s].length>r&&u[s].includes("{")?_=m(_,u[s]):(_+u[s].length>r&&0!==s?(" "===i[i.length-1]&&i.pop(),i.push(t),_=0):0!==s&&(i.push(" "),_++),i.push(u[s]),_+=u[s].length);return i.join("")},load_pgn:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy;function i(e){return e.replace(/\\/g,"\\")}e=e.trim();var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",s=new RegExp("^(\\[((?:"+i(n)+")|.)*\\])(?:\\s*"+i(n)+"){2}"),o=s.test(e)?s.exec(e)[1]:"";d();var a=function(e,t){for(var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",n={},s=e.split(new RegExp(i(r))),o="",a="",l=0;l<s.length;l++){var c=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;o=s[l].replace(c,"$1"),a=s[l].replace(c,"$2"),Xe(o).length>0&&(n[o]=a)}return n}(o,t),l="";for(var h in a)"fen"===h.toLowerCase()&&(l=a[h]),m([h,a[h]]);if(r){if(l&&!f(l,!0))return!1}else if(!("1"!==a.SetUp||"FEN"in a&&f(a.FEN,!0)))return!1;for(var u=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(i(n),"g")," ")).slice(1,e.length-1))}}`},g=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},_=e.replace(o,"").replace(new RegExp(`({[^}]*})+?|;([^${i(n)}]*)`,"g"),(function(e,t,r){return void 0!==t?u(t):" "+u(`{${r.slice(1)}}`)})).replace(new RegExp(i(n),"g")," "),y=/(\([^\(\)]+\))+?/g;y.test(_);)_=_.replace(y,"");var b=Xe(_=(_=(_=_.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));b=b.join(",").replace(/,,+/g,",").split(",");for(var P="",C="",k=0;k<b.length;k++){var w=g(b[k]);if(void 0===w)if(null==(P=T(b[k],r))){if(!(Me.indexOf(b[k])>-1))return!1;C=b[k]}else C="",q(P);else p[v()]=w}return C&&Object.keys(c).length&&!c.Result&&m(["Result",C]),!0},header:function(){return m(arguments)},turn:function(){return i},move:function(e,t){var r=void 0!==t&&"sloppy"in t&&t.sloppy,i=null;if("string"==typeof e)i=T(e,r);else if("object"==typeof e)for(var n=C(),s=0,o=n.length;s<o;s++)if(e.from===Qe(n[s].from)&&e.to===Qe(n[s].to)&&(!("promotion"in n[s])||e.promotion===n[s].promotion)){i=n[s];break}if(!i)return null;var a=R(i);return q(i),a},undo:function(){var e=M();return e?R(e):null},clear:function(){return h()},put:function(e,t){return b(e,t)},get:function(e){return y(e)},ascii(){for(var e="   +------------------------+\n",r=je.a8;r<=je.h1;r++){if(0===He(r)&&(e+=" "+"87654321"[Ke(r)]+" |"),null==t[r])e+=" . ";else{var i=t[r].type;e+=" "+(t[r].color===Je?i.toUpperCase():i.toLowerCase())+" "}r+1&136&&(e+="|\n",r+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h"},remove:function(e){return function(e){var i=y(e);return t[je[e]]=null,i&&i.type===Ze&&(r[i.color]=-1),_(v()),i}(e)},perft:function(e){return O(e)},square_color:function(e){if(e in je){var t=je[e];return(Ke(t)+He(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],r=[],i=(void 0!==e&&"verbose"in e&&e.verbose);l.length>0;)t.push(M());for(;t.length>0;){var n=t.pop();i?r.push(R(n)):r.push(k(n,C({legal:!0}))),q(n)}return r},get_comment:function(){return p[v()]},set_comment:function(e){p[v()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=p[v()];return delete p[v()],e},get_comments:function(){return u(),Object.keys(p).map((function(e){return{fen:e,comment:p[e]}}))},delete_comments:function(){return u(),Object.keys(p).map((function(e){var t=p[e];return delete p[e],{fen:e,comment:t}}))}}},rt=e=>new Promise((t=>setTimeout(t,e))),it=e=>Math.floor(Math.random()*e),nt=(e,t)=>{if(e.preventDefault(),"drop"!=e.type)return;const r=[],i=e.dataTransfer.items;for(let e=0;e<i.length;e++){const t=i[e];if("file"!==t.kind)continue;const n=t.getAsFile();r.push({type:t.type,file:n})}(async e=>new Promise(((t,r)=>{const i=new FileReader;i.onload=e=>{const r=e.target.result;t(r)},i.onerror=i.onabort=e=>{r(e)},i.readAsArrayBuffer(e)})))(r[0].file).then((e=>t(e)))},st=(e,t)=>{e.ondrop=e.ondragover=e=>nt(e,t)};export{tt as Chess};export{rt as sleep};export{it as rnd};export{st as setFileDropHandler};
